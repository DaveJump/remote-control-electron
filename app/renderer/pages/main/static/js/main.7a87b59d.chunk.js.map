{"version":3,"sources":["../external \"electron\"","../../../common/ice-candidate.js","peer-puppet.js","App.jsx","index.jsx"],"names":["module","exports","require","ipcRenderer","initIceCandidate","pc","candidates","listen","event","onicecandidate","e","candidate","console","log","send","toJSON","addIceCandidate","push","remoteDescription","type","i","length","RTCIceCandidate","getScreenStream","a","Promise","resolve","reject","desktopCapturer","getSources","types","sources","navigator","webkitGetUserMedia","audio","video","mandatory","chromeMediaSource","chromeMediaSourceId","id","maxWidth","maxHeight","stream","err","window","RTCPeerConnection","iceCandidateInit","createAnswer","offer","screenStream","addStream","setRemoteDescription","setLocalDescription","JSON","stringify","localDescription","on","answer","sdp","addEventListener","ev","channel","label","onmessage","parse","data","screen","width","height","App","useState","localCode","setLocalCode","controlText","setControlText","controlCode","setControlCode","useEffect","login","handleControlStateChange","removeListener","useCallback","name","text","invoke","code","className","onContextMenu","contextMenu","Menu","append","MenuItem","role","popup","placeholder","value","onInput","target","onClick","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.7a87b59d.chunk.js","sourcesContent":["module.exports = require(\"electron\");","// 每次修改完记得 yarn upgrade project-common\n\nconst { ipcRenderer } = require('electron')\n\nfunction initIceCandidate(pc) {\n  if (!pc) return\n  let candidates = []\n  return {\n    listen(event) {\n      pc.onicecandidate = (e) => {\n        if (e.candidate) {\n          console.log('ice-candidate', e.candidate)\n          ipcRenderer.send('forward', event, e.candidate.toJSON())\n        }\n        // 这里要调 toJSON() 不知道为什么 ipcRenderer.send 不能直接发 candidate 实例，估计 candidate 实例里有函数，electron 克隆算法不支持函数克隆？ <electron@12>\n      }\n    },\n    async addIceCandidate(candidate) {\n      if (candidate) {\n        candidates.push(candidate)\n      }\n      if (pc.remoteDescription && pc.remoteDescription.type) {\n        for (let i = 0; i < candidates.length; i++) {\n          await pc.addIceCandidate(new RTCIceCandidate(candidates[i]))\n        }\n      }\n    }\n  }\n}\n\nmodule.exports = {\n  initIceCandidate\n}\n","import { desktopCapturer, ipcRenderer } from 'electron'\nimport { initIceCandidate } from 'project-common/ice-candidate'\n\nasync function getScreenStream() {\n  return new Promise(async (resolve, reject) => {\n    const sources = await desktopCapturer.getSources({ types: ['screen'] })\n    navigator.webkitGetUserMedia(\n      {\n        audio: false,\n        video: {\n          mandatory: {\n            chromeMediaSource: 'desktop',\n            chromeMediaSourceId: sources[0].id,\n            // maxWidth: window.screen.width,\n            // maxHeight: window.screen.height\n            maxWidth: 1280,\n            maxHeight: 720\n          }\n        }\n      },\n      stream => {\n        resolve(stream)\n      },\n      err => {\n        reject(err)\n      }\n    )\n  })\n}\n\nconst pc = new window.RTCPeerConnection({})\n\nconst iceCandidateInit = initIceCandidate(pc)\n\niceCandidateInit.listen('puppet-candidate')\n\nipcRenderer.on('offer', async (e, offer) => {\n  const answer = await createAnswer(offer)\n  ipcRenderer.send('forward', 'answer', { type: answer.type, sdp: answer.sdp })\n})\n\nipcRenderer.on('candidate', (e, candidate) => {\n  iceCandidateInit.addIceCandidate(candidate)\n})\n\nasync function createAnswer(offer) {\n  let screenStream = await getScreenStream()\n  pc.addStream(screenStream)\n  await pc.setRemoteDescription(offer)\n  await pc.setLocalDescription(await pc.createAnswer())\n  console.log(JSON.stringify(pc.localDescription))\n  return pc.localDescription\n}\n\n// 处理键鼠响应\npc.addEventListener('datachannel', ev => {\n  if (ev.channel.label === 'robotChannel') {\n    ev.channel.onmessage = e => {\n      let { type, data } = JSON.parse(e.data)\n      if (type === 'mouse') {\n        // 傀儡端需加上 screenWidth 和 screenHeight\n        data.screen = {\n          width: window.screen.width,\n          height: window.screen.height\n        }\n      }\n      ipcRenderer.send('robot', type, data)\n    }\n  }\n})\n","import { ipcRenderer } from 'electron'\nimport { Menu, MenuItem } from '@electron/remote'\nimport { useState, useEffect, useCallback } from 'react'\nimport './App.css'\nimport './peer-puppet'\n\nfunction App() {\n  const [localCode, setLocalCode] = useState('')\n  const [controlText, setControlText] = useState('')\n  const [controlCode, setControlCode] = useState('')\n\n  useEffect(() => {\n    login()\n    ipcRenderer.on('control-state-change', handleControlStateChange)\n\n    return () => {\n      ipcRenderer.removeListener(\n        'control-state-change',\n        handleControlStateChange\n      )\n    }\n    // eslint-disable-next-line\n  }, [])\n\n  const startControl = () => {\n    ipcRenderer.send('control', controlCode)\n  }\n\n  const handleControlStateChange = useCallback((e, name, type) => {\n    let text = ''\n    if (type === 1) {\n      text = `正在远程控制${name}`\n    } else if (type === 2) {\n      text = `正在被${name}远程控制`\n    }\n    setControlText(text)\n  }, [])\n\n  const login = async () => {\n    const code = await ipcRenderer.invoke('login')\n    setLocalCode(code)\n  }\n\n  const handleContextMenu = e => {\n    // e.preventDefault()\n    const contextMenu = new Menu()\n    contextMenu.append(\n      new MenuItem({\n        label: 'Copy',\n        role: 'copy'\n      })\n    )\n    contextMenu.popup()\n  }\n\n  return (\n    <div className=\"control-main\">\n      {!controlText.length ? (\n        <>\n          <div className=\"local-code\">\n            Local control code:{' '}\n            <span onContextMenu={handleContextMenu}>{localCode}</span>\n          </div>\n          <div className=\"operator\">\n            <input\n              placeholder=\"Enter remote control code\"\n              type=\"text\"\n              value={controlCode}\n              onInput={e => setControlCode(e.target.value)}\n            />\n            <button onClick={startControl}>Confirm</button>\n          </div>\n        </>\n      ) : (\n        <div className=\"control-text\">{controlText}</div>\n      )}\n    </div>\n  )\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\n// import reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals()\n"],"sourceRoot":""}